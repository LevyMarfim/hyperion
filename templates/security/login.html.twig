{% extends 'base.html.twig' %}

{% block title %}Log in!{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('styles/login.css') }}">
{% endblock %}

{% block body %}
<div class="login-container" data-controller="login">
    <div class="login-card card">
        <div class="card-body p-4 p-md-5">
            {# Logo/Brand Section #}
            <div class="text-center mb-4">
                <div class="login-logo">
                    <i class="fas fa-lock"></i>
                </div>
                <h2 class="fw-bold text-dark mb-2">Welcome Back</h2>
                <p class="text-muted">Please sign in to your account</p>
            </div>

            {# Login Form #}
            <form method="post" 
                  class="needs-validation" 
                  novalidate
                  data-login-target="form">
                  
                {# Error Message #}
                {% if error %}
                    <div class="alert alert-danger d-flex align-items-center mb-4" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <div class="small">{{ error.messageKey|trans(error.messageData, 'security') }}</div>
                    </div>
                {% endif %}

                {# Already Logged In #}
                {% if app.user %}
                    <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
                        <i class="fas fa-info-circle me-2"></i>
                        <div class="small">
                            You are logged in as <strong>{{ app.user.userIdentifier }}</strong>
                            <a href="{{ path('app_logout') }}" class="alert-link ms-1 text-decoration-none">Logout</a>
                        </div>
                    </div>
                {% endif %}

                {# Username Field #}
                <div class="form-floating mb-3">
                    <input type="text" 
                           value="{{ last_username }}" 
                           name="_username" 
                           id="username" 
                           class="form-control" 
                           placeholder="name@example.com"
                           autocomplete="username" 
                           required 
                           autofocus
                           data-login-target="username">
                    <label for="username">
                        <i class="fas fa-user me-2"></i>Username or Email
                    </label>
                    <div class="invalid-feedback">
                        Please enter your username or email.
                    </div>
                </div>

                {# Password Field #}
                <div class="form-floating mb-4">
                    <input type="password" 
                           name="_password" 
                           id="password" 
                           class="form-control" 
                           placeholder="Password"
                           autocomplete="current-password" 
                           required
                           data-login-target="password">
                    <label for="password">
                        <i class="fas fa-key me-2"></i>Password
                    </label>
                    <div class="invalid-feedback">
                        Please enter your password.
                    </div>
                </div>

                {# Remember Me & Forgot Password #}
                <div class="d-flex justify-content-between align-items-center mb-4">
                    {# Remember Me (uncomment if needed) #}
                    {#
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="_remember_me" id="_remember_me">
                        <label class="form-check-label text-muted small" for="_remember_me">
                            Remember me
                        </label>
                    </div>
                    #}

                    {# Forgot Password #}
                    <div class="ms-auto">
                        <a href="#" class="text-decoration-none text-muted small">
                            <i class="fas fa-question-circle me-1"></i>Forgot password?
                        </a>
                    </div>
                </div>

                {# CSRF Token #}
                <input type="hidden" name="_csrf_token" value="{{ csrf_token('authenticate') }}">

                {# Submit Button #}
                <div class="d-grid mb-3">
                    <button class="btn btn-login text-white fw-bold" type="submit">
                        <i class="fas fa-sign-in-alt me-2"></i>Sign In
                    </button>
                </div>

                {# Demo Button (development only) #}
                {% if app.environment == 'dev' %}
                <div class="d-grid">
                    <button type="button" 
                            class="btn btn-outline-secondary btn-sm" 
                            data-action="click->login#fillDemoCredentials">
                        <i class="fas fa-magic me-1"></i>Fill Demo Credentials
                    </button>
                </div>
                {% endif %}
            </form>

            {# Footer #}
            <div class="text-center mt-4 pt-3 border-top">
                <p class="text-muted small mb-0">
                    &copy; {{ "now"|date("Y") }} Your Company. All rights reserved.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
{% endblock %}